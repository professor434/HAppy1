var pt=Object.defineProperty;var mt=(r,t,e)=>t in r?pt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var L=(r,t,e)=>mt(r,typeof t!="symbol"?t+"":t,e);import{L as $t,C as Rt,S as Le,f as U,h as Se,i as It,g as gt,j as we,l as Ne,D as vt,k as Lt}from"./index-Dli5q7WS.js";const St="transport";class j{constructor({context:t,logType:e}={}){L(this,"exchangeTimeout",3e4);L(this,"unresponsiveTimeout",15e3);L(this,"deviceModel",null);L(this,"tracer");L(this,"_events",new Rt);L(this,"send",async(t,e,s,i,a=Buffer.alloc(0),c=[Le.OK],{abortTimeoutMs:u}={})=>{const o=this.tracer.withUpdatedContext({function:"send"});if(a.length>=256)throw o.trace("data.length exceeded 256 bytes limit",{dataLength:a.length}),new U("data.length exceed 256 bytes limit. Got: "+a.length,"DataLengthTooBig");o.trace("Starting an exchange",{abortTimeoutMs:u});const R=await this.exchange(Buffer.concat([Buffer.from([t,e,s,i]),Buffer.from([a.length]),a]),{abortTimeoutMs:u});o.trace("Received response from exchange");const n=R.readUInt16BE(R.length-2);if(!c.some(d=>d===n))throw new Se(n);return R});L(this,"exchangeBusyPromise");L(this,"_appAPIlock",null);this.tracer=new $t(e??St,t)}exchange(t,{abortTimeoutMs:e}={}){throw new Error("exchange not implemented")}exchangeBulk(t,e){let s=!1;const i=()=>{s=!0};return(async()=>{if(!s)for(const c of t){const u=await this.exchange(c);if(s)return;const o=u.readUInt16BE(u.length-2);if(o!==Le.OK)throw new Se(o);e.next(u)}})().then(()=>!s&&e.complete(),c=>!s&&e.error(c)),{unsubscribe:i}}setScrambleKey(t){}close(){return Promise.resolve()}on(t,e){this._events.on(t,e)}off(t,e){this._events.removeListener(t,e)}emit(t,...e){this._events.emit(t,...e)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(t){this.exchangeTimeout=t}setExchangeUnresponsiveTimeout(t){this.unresponsiveTimeout=t}static create(t=3e3,e){return new Promise((s,i)=>{let a=!1;const c=this.listen({next:o=>{a=!0,c&&c.unsubscribe(),u&&clearTimeout(u),this.open(o.descriptor,t).then(s,i)},error:o=>{u&&clearTimeout(u),i(o)},complete:()=>{u&&clearTimeout(u),a||i(new U(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),u=e?setTimeout(()=>{c.unsubscribe(),i(new U(this.ErrorMessage_ListenTimeout,"ListenTimeout"))},e):null})}async exchangeAtomicImpl(t){const e=this.tracer.withUpdatedContext({function:"exchangeAtomicImpl",unresponsiveTimeout:this.unresponsiveTimeout});if(this.exchangeBusyPromise)throw e.trace("Atomic exchange is already busy"),new It("An action was already pending on the Ledger device. Please deny or reconnect.");let s;const i=new Promise(u=>{s=u});this.exchangeBusyPromise=i;let a=!1;const c=setTimeout(()=>{e.trace('Timeout reached, emitting Transport event "unresponsive"',{unresponsiveTimeout:this.unresponsiveTimeout}),a=!0,this.emit("unresponsive")},this.unresponsiveTimeout);try{const u=await t();return a&&(e.trace("Device was unresponsive, emitting responsive"),this.emit("responsive")),u}finally{e.trace("Finalize, clearing busy guard"),clearTimeout(c),s&&s(),this.exchangeBusyPromise=null}}decorateAppAPIMethods(t,e,s){for(const i of e)t[i]=this.decorateAppAPIMethod(i,t[i],t,s)}decorateAppAPIMethod(t,e,s,i){return async(...a)=>{const{_appAPIlock:c}=this;if(c)return Promise.reject(new U("Ledger Device is busy (lock "+c+")","TransportLocked"));try{return this._appAPIlock=t,this.setScrambleKey(i),await e.apply(s,a)}finally{this._appAPIlock=null}}}setTraceContext(t){this.tracer=this.tracer.withContext(t)}updateTraceContext(t){this.tracer.updateContext(t)}getTraceContext(){return this.tracer.getContext()}}L(j,"isSupported"),L(j,"list"),L(j,"listen"),L(j,"open"),L(j,"ErrorMessage_ListenTimeout","No Ledger device found (timeout)"),L(j,"ErrorMessage_NoDeviceFound","No Ledger device found");const Te=5;function wt(r){const t=Buffer.alloc(2);return t.writeUInt16BE(r,0),t}const Nt={data:Buffer.alloc(0),dataLength:0,sequence:0},Tt=(r,t)=>({makeBlocks(e){let s=Buffer.concat([wt(e.length),e]);const i=t-5,a=Math.ceil(s.length/i);s=Buffer.concat([s,Buffer.alloc(a*i-s.length+1).fill(0)]);const c=[];for(let u=0;u<a;u++){const o=Buffer.alloc(5);o.writeUInt16BE(r,0),o.writeUInt8(Te,2),o.writeUInt16BE(u,3);const R=s.slice(u*i,(u+1)*i);c.push(Buffer.concat([o,R]))}return c},reduceResponse(e,s){let{data:i,dataLength:a,sequence:c}=e||Nt;if(s.readUInt16BE(0)!==r)throw new U("Invalid channel","InvalidChannel");if(s.readUInt8(2)!==Te)throw new U("Invalid tag","InvalidTag");if(s.readUInt16BE(3)!==c)throw new U("Invalid sequence","InvalidSequence");e||(a=s.readUInt16BE(5)),c++;const u=s.slice(e?5:7);return i=Buffer.concat([i,u]),i.length>a&&(i=i.slice(0,a)),{data:i,dataLength:a,sequence:c}},getReducedResult(e){if(e&&e.dataLength===e.data.length)return e.data}});var fe={exports:{}};const Ot="2.0.0",Ze=256,At=Number.MAX_SAFE_INTEGER||9007199254740991,Pt=16,yt=Ze-6,Ct=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var ee={MAX_LENGTH:Ze,MAX_SAFE_COMPONENT_LENGTH:Pt,MAX_SAFE_BUILD_LENGTH:yt,MAX_SAFE_INTEGER:At,RELEASE_TYPES:Ct,SEMVER_SPEC_VERSION:Ot,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},ie={};const xt=typeof process=="object"&&ie&&ie.NODE_DEBUG&&/\bsemver\b/i.test(ie.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};var te=xt;(function(r,t){const{MAX_SAFE_COMPONENT_LENGTH:e,MAX_SAFE_BUILD_LENGTH:s,MAX_LENGTH:i}=ee,a=te;t=r.exports={};const c=t.re=[],u=t.safeRe=[],o=t.src=[],R=t.safeSrc=[],n=t.t={};let d=0;const S="[a-zA-Z0-9-]",p=[["\\s",1],["\\d",i],[S,s]],V=b=>{for(const[C,B]of p)b=b.split(`${C}*`).join(`${C}{0,${B}}`).split(`${C}+`).join(`${C}{1,${B}}`);return b},I=(b,C,B)=>{const A=V(C),G=d++;a(b,G,C),n[b]=G,o[G]=C,R[G]=A,c[G]=new RegExp(C,B?"g":void 0),u[G]=new RegExp(A,B?"g":void 0)};I("NUMERICIDENTIFIER","0|[1-9]\\d*"),I("NUMERICIDENTIFIERLOOSE","\\d+"),I("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${S}*`),I("MAINVERSION",`(${o[n.NUMERICIDENTIFIER]})\\.(${o[n.NUMERICIDENTIFIER]})\\.(${o[n.NUMERICIDENTIFIER]})`),I("MAINVERSIONLOOSE",`(${o[n.NUMERICIDENTIFIERLOOSE]})\\.(${o[n.NUMERICIDENTIFIERLOOSE]})\\.(${o[n.NUMERICIDENTIFIERLOOSE]})`),I("PRERELEASEIDENTIFIER",`(?:${o[n.NONNUMERICIDENTIFIER]}|${o[n.NUMERICIDENTIFIER]})`),I("PRERELEASEIDENTIFIERLOOSE",`(?:${o[n.NONNUMERICIDENTIFIER]}|${o[n.NUMERICIDENTIFIERLOOSE]})`),I("PRERELEASE",`(?:-(${o[n.PRERELEASEIDENTIFIER]}(?:\\.${o[n.PRERELEASEIDENTIFIER]})*))`),I("PRERELEASELOOSE",`(?:-?(${o[n.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${o[n.PRERELEASEIDENTIFIERLOOSE]})*))`),I("BUILDIDENTIFIER",`${S}+`),I("BUILD",`(?:\\+(${o[n.BUILDIDENTIFIER]}(?:\\.${o[n.BUILDIDENTIFIER]})*))`),I("FULLPLAIN",`v?${o[n.MAINVERSION]}${o[n.PRERELEASE]}?${o[n.BUILD]}?`),I("FULL",`^${o[n.FULLPLAIN]}$`),I("LOOSEPLAIN",`[v=\\s]*${o[n.MAINVERSIONLOOSE]}${o[n.PRERELEASELOOSE]}?${o[n.BUILD]}?`),I("LOOSE",`^${o[n.LOOSEPLAIN]}$`),I("GTLT","((?:<|>)?=?)"),I("XRANGEIDENTIFIERLOOSE",`${o[n.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),I("XRANGEIDENTIFIER",`${o[n.NUMERICIDENTIFIER]}|x|X|\\*`),I("XRANGEPLAIN",`[v=\\s]*(${o[n.XRANGEIDENTIFIER]})(?:\\.(${o[n.XRANGEIDENTIFIER]})(?:\\.(${o[n.XRANGEIDENTIFIER]})(?:${o[n.PRERELEASE]})?${o[n.BUILD]}?)?)?`),I("XRANGEPLAINLOOSE",`[v=\\s]*(${o[n.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[n.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[n.XRANGEIDENTIFIERLOOSE]})(?:${o[n.PRERELEASELOOSE]})?${o[n.BUILD]}?)?)?`),I("XRANGE",`^${o[n.GTLT]}\\s*${o[n.XRANGEPLAIN]}$`),I("XRANGELOOSE",`^${o[n.GTLT]}\\s*${o[n.XRANGEPLAINLOOSE]}$`),I("COERCEPLAIN",`(^|[^\\d])(\\d{1,${e}})(?:\\.(\\d{1,${e}}))?(?:\\.(\\d{1,${e}}))?`),I("COERCE",`${o[n.COERCEPLAIN]}(?:$|[^\\d])`),I("COERCEFULL",o[n.COERCEPLAIN]+`(?:${o[n.PRERELEASE]})?(?:${o[n.BUILD]})?(?:$|[^\\d])`),I("COERCERTL",o[n.COERCE],!0),I("COERCERTLFULL",o[n.COERCEFULL],!0),I("LONETILDE","(?:~>?)"),I("TILDETRIM",`(\\s*)${o[n.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",I("TILDE",`^${o[n.LONETILDE]}${o[n.XRANGEPLAIN]}$`),I("TILDELOOSE",`^${o[n.LONETILDE]}${o[n.XRANGEPLAINLOOSE]}$`),I("LONECARET","(?:\\^)"),I("CARETTRIM",`(\\s*)${o[n.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",I("CARET",`^${o[n.LONECARET]}${o[n.XRANGEPLAIN]}$`),I("CARETLOOSE",`^${o[n.LONECARET]}${o[n.XRANGEPLAINLOOSE]}$`),I("COMPARATORLOOSE",`^${o[n.GTLT]}\\s*(${o[n.LOOSEPLAIN]})$|^$`),I("COMPARATOR",`^${o[n.GTLT]}\\s*(${o[n.FULLPLAIN]})$|^$`),I("COMPARATORTRIM",`(\\s*)${o[n.GTLT]}\\s*(${o[n.LOOSEPLAIN]}|${o[n.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",I("HYPHENRANGE",`^\\s*(${o[n.XRANGEPLAIN]})\\s+-\\s+(${o[n.XRANGEPLAIN]})\\s*$`),I("HYPHENRANGELOOSE",`^\\s*(${o[n.XRANGEPLAINLOOSE]})\\s+-\\s+(${o[n.XRANGEPLAINLOOSE]})\\s*$`),I("STAR","(<|>)?=?\\s*\\*"),I("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),I("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(fe,fe.exports);var z=fe.exports;const Dt=Object.freeze({loose:!0}),_t=Object.freeze({}),Ut=r=>r?typeof r!="object"?Dt:r:_t;var de=Ut;const Oe=/^[0-9]+$/,Je=(r,t)=>{const e=Oe.test(r),s=Oe.test(t);return e&&s&&(r=+r,t=+t),r===t?0:e&&!s?-1:s&&!e?1:r<t?-1:1},bt=(r,t)=>Je(t,r);var Qe={compareIdentifiers:Je,rcompareIdentifiers:bt};const H=te,{MAX_LENGTH:Ae,MAX_SAFE_INTEGER:Y}=ee,{safeRe:W,t:K}=z,Gt=de,{compareIdentifiers:k}=Qe;let Ft=class _{constructor(t,e){if(e=Gt(e),t instanceof _){if(t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>Ae)throw new TypeError(`version is longer than ${Ae} characters`);H("SemVer",t,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;const s=t.trim().match(e.loose?W[K.LOOSE]:W[K.FULL]);if(!s)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>Y||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Y||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Y||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){const a=+i;if(a>=0&&a<Y)return a}return i}):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(H("SemVer.compare",this.version,this.options,t),!(t instanceof _)){if(typeof t=="string"&&t===this.version)return 0;t=new _(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof _||(t=new _(t,this.options)),k(this.major,t.major)||k(this.minor,t.minor)||k(this.patch,t.patch)}comparePre(t){if(t instanceof _||(t=new _(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let e=0;do{const s=this.prerelease[e],i=t.prerelease[e];if(H("prerelease compare",e,s,i),s===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(s===void 0)return-1;if(s===i)continue;return k(s,i)}while(++e)}compareBuild(t){t instanceof _||(t=new _(t,this.options));let e=0;do{const s=this.build[e],i=t.build[e];if(H("build compare",e,s,i),s===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(s===void 0)return-1;if(s===i)continue;return k(s,i)}while(++e)}inc(t,e,s){if(t.startsWith("pre")){if(!e&&s===!1)throw new Error("invalid increment argument: identifier is empty");if(e){const i=`-${e}`.match(this.options.loose?W[K.PRERELEASELOOSE]:W[K.PRERELEASE]);if(!i||i[1]!==e)throw new Error(`invalid identifier: ${e}`)}}switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e,s);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e,s);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e,s),this.inc("pre",e,s);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e,s),this.inc("pre",e,s);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const i=Number(s)?1:0;if(this.prerelease.length===0)this.prerelease=[i];else{let a=this.prerelease.length;for(;--a>=0;)typeof this.prerelease[a]=="number"&&(this.prerelease[a]++,a=-2);if(a===-1){if(e===this.prerelease.join(".")&&s===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(e){let a=[e,i];s===!1&&(a=[e]),k(this.prerelease[0],e)===0?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var P=Ft;const Pe=P,Bt=(r,t,e=!1)=>{if(r instanceof Pe)return r;try{return new Pe(r,t)}catch(s){if(!e)return null;throw s}};var X=Bt;const jt=X,kt=(r,t)=>{const e=jt(r,t);return e?e.version:null};var Xt=kt;const Vt=X,Mt=(r,t)=>{const e=Vt(r.trim().replace(/^[=v]+/,""),t);return e?e.version:null};var qt=Mt;const ye=P,zt=(r,t,e,s,i)=>{typeof e=="string"&&(i=s,s=e,e=void 0);try{return new ye(r instanceof ye?r.version:r,e).inc(t,s,i).version}catch{return null}};var Ht=zt;const Ce=X,Yt=(r,t)=>{const e=Ce(r,null,!0),s=Ce(t,null,!0),i=e.compare(s);if(i===0)return null;const a=i>0,c=a?e:s,u=a?s:e,o=!!c.prerelease.length;if(!!u.prerelease.length&&!o){if(!u.patch&&!u.minor)return"major";if(u.compareMain(c)===0)return u.minor&&!u.patch?"minor":"patch"}const n=o?"pre":"";return e.major!==s.major?n+"major":e.minor!==s.minor?n+"minor":e.patch!==s.patch?n+"patch":"prerelease"};var Wt=Yt;const Kt=P,Zt=(r,t)=>new Kt(r,t).major;var Jt=Zt;const Qt=P,er=(r,t)=>new Qt(r,t).minor;var tr=er;const rr=P,sr=(r,t)=>new rr(r,t).patch;var nr=sr;const ir=X,or=(r,t)=>{const e=ir(r,t);return e&&e.prerelease.length?e.prerelease:null};var ar=or;const xe=P,cr=(r,t,e)=>new xe(r,e).compare(new xe(t,e));var x=cr;const lr=x,ur=(r,t,e)=>lr(t,r,e);var fr=ur;const hr=x,Er=(r,t)=>hr(r,t,!0);var dr=Er;const De=P,pr=(r,t,e)=>{const s=new De(r,e),i=new De(t,e);return s.compare(i)||s.compareBuild(i)};var pe=pr;const mr=pe,$r=(r,t)=>r.sort((e,s)=>mr(e,s,t));var Rr=$r;const Ir=pe,gr=(r,t)=>r.sort((e,s)=>Ir(s,e,t));var vr=gr;const Lr=x,Sr=(r,t,e)=>Lr(r,t,e)>0;var re=Sr;const wr=x,Nr=(r,t,e)=>wr(r,t,e)<0;var me=Nr;const Tr=x,Or=(r,t,e)=>Tr(r,t,e)===0;var et=Or;const Ar=x,Pr=(r,t,e)=>Ar(r,t,e)!==0;var tt=Pr;const yr=x,Cr=(r,t,e)=>yr(r,t,e)>=0;var $e=Cr;const xr=x,Dr=(r,t,e)=>xr(r,t,e)<=0;var Re=Dr;const _r=et,Ur=tt,br=re,Gr=$e,Fr=me,Br=Re,jr=(r,t,e,s)=>{switch(t){case"===":return typeof r=="object"&&(r=r.version),typeof e=="object"&&(e=e.version),r===e;case"!==":return typeof r=="object"&&(r=r.version),typeof e=="object"&&(e=e.version),r!==e;case"":case"=":case"==":return _r(r,e,s);case"!=":return Ur(r,e,s);case">":return br(r,e,s);case">=":return Gr(r,e,s);case"<":return Fr(r,e,s);case"<=":return Br(r,e,s);default:throw new TypeError(`Invalid operator: ${t}`)}};var rt=jr;const kr=P,Xr=X,{safeRe:Z,t:J}=z,Vr=(r,t)=>{if(r instanceof kr)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;t=t||{};let e=null;if(!t.rtl)e=r.match(t.includePrerelease?Z[J.COERCEFULL]:Z[J.COERCE]);else{const o=t.includePrerelease?Z[J.COERCERTLFULL]:Z[J.COERCERTL];let R;for(;(R=o.exec(r))&&(!e||e.index+e[0].length!==r.length);)(!e||R.index+R[0].length!==e.index+e[0].length)&&(e=R),o.lastIndex=R.index+R[1].length+R[2].length;o.lastIndex=-1}if(e===null)return null;const s=e[2],i=e[3]||"0",a=e[4]||"0",c=t.includePrerelease&&e[5]?`-${e[5]}`:"",u=t.includePrerelease&&e[6]?`+${e[6]}`:"";return Xr(`${s}.${i}.${a}${c}${u}`,t)};var Mr=Vr;class qr{constructor(){this.max=1e3,this.map=new Map}get(t){const e=this.map.get(t);if(e!==void 0)return this.map.delete(t),this.map.set(t,e),e}delete(t){return this.map.delete(t)}set(t,e){if(!this.delete(t)&&e!==void 0){if(this.map.size>=this.max){const i=this.map.keys().next().value;this.delete(i)}this.map.set(t,e)}return this}}var zr=qr,oe,_e;function D(){if(_e)return oe;_e=1;const r=/\s+/g;class t{constructor(l,m){if(m=i(m),l instanceof t)return l.loose===!!m.loose&&l.includePrerelease===!!m.includePrerelease?l:new t(l.raw,m);if(l instanceof a)return this.raw=l.value,this.set=[[l]],this.formatted=void 0,this;if(this.options=m,this.loose=!!m.loose,this.includePrerelease=!!m.includePrerelease,this.raw=l.trim().replace(r," "),this.set=this.raw.split("||").map(h=>this.parseRange(h.trim())).filter(h=>h.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const h=this.set[0];if(this.set=this.set.filter($=>!I($[0])),this.set.length===0)this.set=[h];else if(this.set.length>1){for(const $ of this.set)if($.length===1&&b($[0])){this.set=[$];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let l=0;l<this.set.length;l++){l>0&&(this.formatted+="||");const m=this.set[l];for(let h=0;h<m.length;h++)h>0&&(this.formatted+=" "),this.formatted+=m[h].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(l){const h=((this.options.includePrerelease&&p)|(this.options.loose&&V))+":"+l,$=s.get(h);if($)return $;const E=this.options.loose,g=E?o[R.HYPHENRANGELOOSE]:o[R.HYPHENRANGE];l=l.replace(g,Et(this.options.includePrerelease)),c("hyphen replace",l),l=l.replace(o[R.COMPARATORTRIM],n),c("comparator trim",l),l=l.replace(o[R.TILDETRIM],d),c("tilde trim",l),l=l.replace(o[R.CARETTRIM],S),c("caret trim",l);let w=l.split(" ").map(T=>B(T,this.options)).join(" ").split(/\s+/).map(T=>ht(T,this.options));E&&(w=w.filter(T=>(c("loose invalid filter",T,this.options),!!T.match(o[R.COMPARATORLOOSE])))),c("range list",w);const v=new Map,N=w.map(T=>new a(T,this.options));for(const T of N){if(I(T))return[T];v.set(T.value,T)}v.size>1&&v.has("")&&v.delete("");const y=[...v.values()];return s.set(h,y),y}intersects(l,m){if(!(l instanceof t))throw new TypeError("a Range is required");return this.set.some(h=>C(h,m)&&l.set.some($=>C($,m)&&h.every(E=>$.every(g=>E.intersects(g,m)))))}test(l){if(!l)return!1;if(typeof l=="string")try{l=new u(l,this.options)}catch{return!1}for(let m=0;m<this.set.length;m++)if(dt(this.set[m],l,this.options))return!0;return!1}}oe=t;const e=zr,s=new e,i=de,a=se(),c=te,u=P,{safeRe:o,t:R,comparatorTrimReplace:n,tildeTrimReplace:d,caretTrimReplace:S}=z,{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:V}=ee,I=f=>f.value==="<0.0.0-0",b=f=>f.value==="",C=(f,l)=>{let m=!0;const h=f.slice();let $=h.pop();for(;m&&h.length;)m=h.every(E=>$.intersects(E,l)),$=h.pop();return m},B=(f,l)=>(c("comp",f,l),f=at(f,l),c("caret",f),f=G(f,l),c("tildes",f),f=lt(f,l),c("xrange",f),f=ft(f,l),c("stars",f),f),A=f=>!f||f.toLowerCase()==="x"||f==="*",G=(f,l)=>f.trim().split(/\s+/).map(m=>ot(m,l)).join(" "),ot=(f,l)=>{const m=l.loose?o[R.TILDELOOSE]:o[R.TILDE];return f.replace(m,(h,$,E,g,w)=>{c("tilde",f,h,$,E,g,w);let v;return A($)?v="":A(E)?v=`>=${$}.0.0 <${+$+1}.0.0-0`:A(g)?v=`>=${$}.${E}.0 <${$}.${+E+1}.0-0`:w?(c("replaceTilde pr",w),v=`>=${$}.${E}.${g}-${w} <${$}.${+E+1}.0-0`):v=`>=${$}.${E}.${g} <${$}.${+E+1}.0-0`,c("tilde return",v),v})},at=(f,l)=>f.trim().split(/\s+/).map(m=>ct(m,l)).join(" "),ct=(f,l)=>{c("caret",f,l);const m=l.loose?o[R.CARETLOOSE]:o[R.CARET],h=l.includePrerelease?"-0":"";return f.replace(m,($,E,g,w,v)=>{c("caret",f,$,E,g,w,v);let N;return A(E)?N="":A(g)?N=`>=${E}.0.0${h} <${+E+1}.0.0-0`:A(w)?E==="0"?N=`>=${E}.${g}.0${h} <${E}.${+g+1}.0-0`:N=`>=${E}.${g}.0${h} <${+E+1}.0.0-0`:v?(c("replaceCaret pr",v),E==="0"?g==="0"?N=`>=${E}.${g}.${w}-${v} <${E}.${g}.${+w+1}-0`:N=`>=${E}.${g}.${w}-${v} <${E}.${+g+1}.0-0`:N=`>=${E}.${g}.${w}-${v} <${+E+1}.0.0-0`):(c("no pr"),E==="0"?g==="0"?N=`>=${E}.${g}.${w}${h} <${E}.${g}.${+w+1}-0`:N=`>=${E}.${g}.${w}${h} <${E}.${+g+1}.0-0`:N=`>=${E}.${g}.${w} <${+E+1}.0.0-0`),c("caret return",N),N})},lt=(f,l)=>(c("replaceXRanges",f,l),f.split(/\s+/).map(m=>ut(m,l)).join(" ")),ut=(f,l)=>{f=f.trim();const m=l.loose?o[R.XRANGELOOSE]:o[R.XRANGE];return f.replace(m,(h,$,E,g,w,v)=>{c("xRange",f,h,$,E,g,w,v);const N=A(E),y=N||A(g),T=y||A(w),M=T;return $==="="&&M&&($=""),v=l.includePrerelease?"-0":"",N?$===">"||$==="<"?h="<0.0.0-0":h="*":$&&M?(y&&(g=0),w=0,$===">"?($=">=",y?(E=+E+1,g=0,w=0):(g=+g+1,w=0)):$==="<="&&($="<",y?E=+E+1:g=+g+1),$==="<"&&(v="-0"),h=`${$+E}.${g}.${w}${v}`):y?h=`>=${E}.0.0${v} <${+E+1}.0.0-0`:T&&(h=`>=${E}.${g}.0${v} <${E}.${+g+1}.0-0`),c("xRange return",h),h})},ft=(f,l)=>(c("replaceStars",f,l),f.trim().replace(o[R.STAR],"")),ht=(f,l)=>(c("replaceGTE0",f,l),f.trim().replace(o[l.includePrerelease?R.GTE0PRE:R.GTE0],"")),Et=f=>(l,m,h,$,E,g,w,v,N,y,T,M)=>(A(h)?m="":A($)?m=`>=${h}.0.0${f?"-0":""}`:A(E)?m=`>=${h}.${$}.0${f?"-0":""}`:g?m=`>=${m}`:m=`>=${m}${f?"-0":""}`,A(N)?v="":A(y)?v=`<${+N+1}.0.0-0`:A(T)?v=`<${N}.${+y+1}.0-0`:M?v=`<=${N}.${y}.${T}-${M}`:f?v=`<${N}.${y}.${+T+1}-0`:v=`<=${v}`,`${m} ${v}`.trim()),dt=(f,l,m)=>{for(let h=0;h<f.length;h++)if(!f[h].test(l))return!1;if(l.prerelease.length&&!m.includePrerelease){for(let h=0;h<f.length;h++)if(c(f[h].semver),f[h].semver!==a.ANY&&f[h].semver.prerelease.length>0){const $=f[h].semver;if($.major===l.major&&$.minor===l.minor&&$.patch===l.patch)return!0}return!1}return!0};return oe}var ae,Ue;function se(){if(Ue)return ae;Ue=1;const r=Symbol("SemVer ANY");class t{static get ANY(){return r}constructor(n,d){if(d=e(d),n instanceof t){if(n.loose===!!d.loose)return n;n=n.value}n=n.trim().split(/\s+/).join(" "),c("comparator",n,d),this.options=d,this.loose=!!d.loose,this.parse(n),this.semver===r?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(n){const d=this.options.loose?s[i.COMPARATORLOOSE]:s[i.COMPARATOR],S=n.match(d);if(!S)throw new TypeError(`Invalid comparator: ${n}`);this.operator=S[1]!==void 0?S[1]:"",this.operator==="="&&(this.operator=""),S[2]?this.semver=new u(S[2],this.options.loose):this.semver=r}toString(){return this.value}test(n){if(c("Comparator.test",n,this.options.loose),this.semver===r||n===r)return!0;if(typeof n=="string")try{n=new u(n,this.options)}catch{return!1}return a(n,this.operator,this.semver,this.options)}intersects(n,d){if(!(n instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new o(n.value,d).test(this.value):n.operator===""?n.value===""?!0:new o(this.value,d).test(n.semver):(d=e(d),d.includePrerelease&&(this.value==="<0.0.0-0"||n.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||n.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&n.operator.startsWith(">")||this.operator.startsWith("<")&&n.operator.startsWith("<")||this.semver.version===n.semver.version&&this.operator.includes("=")&&n.operator.includes("=")||a(this.semver,"<",n.semver,d)&&this.operator.startsWith(">")&&n.operator.startsWith("<")||a(this.semver,">",n.semver,d)&&this.operator.startsWith("<")&&n.operator.startsWith(">")))}}ae=t;const e=de,{safeRe:s,t:i}=z,a=rt,c=te,u=P,o=D();return ae}const Hr=D(),Yr=(r,t,e)=>{try{t=new Hr(t,e)}catch{return!1}return t.test(r)};var ne=Yr;const Wr=D(),Kr=(r,t)=>new Wr(r,t).set.map(e=>e.map(s=>s.value).join(" ").trim().split(" "));var Zr=Kr;const Jr=P,Qr=D(),es=(r,t,e)=>{let s=null,i=null,a=null;try{a=new Qr(t,e)}catch{return null}return r.forEach(c=>{a.test(c)&&(!s||i.compare(c)===-1)&&(s=c,i=new Jr(s,e))}),s};var ts=es;const rs=P,ss=D(),ns=(r,t,e)=>{let s=null,i=null,a=null;try{a=new ss(t,e)}catch{return null}return r.forEach(c=>{a.test(c)&&(!s||i.compare(c)===1)&&(s=c,i=new rs(s,e))}),s};var is=ns;const ce=P,os=D(),be=re,as=(r,t)=>{r=new os(r,t);let e=new ce("0.0.0");if(r.test(e)||(e=new ce("0.0.0-0"),r.test(e)))return e;e=null;for(let s=0;s<r.set.length;++s){const i=r.set[s];let a=null;i.forEach(c=>{const u=new ce(c.semver.version);switch(c.operator){case">":u.prerelease.length===0?u.patch++:u.prerelease.push(0),u.raw=u.format();case"":case">=":(!a||be(u,a))&&(a=u);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${c.operator}`)}}),a&&(!e||be(e,a))&&(e=a)}return e&&r.test(e)?e:null};var cs=as;const ls=D(),us=(r,t)=>{try{return new ls(r,t).range||"*"}catch{return null}};var fs=us;const hs=P,st=se(),{ANY:Es}=st,ds=D(),ps=ne,Ge=re,Fe=me,ms=Re,$s=$e,Rs=(r,t,e,s)=>{r=new hs(r,s),t=new ds(t,s);let i,a,c,u,o;switch(e){case">":i=Ge,a=ms,c=Fe,u=">",o=">=";break;case"<":i=Fe,a=$s,c=Ge,u="<",o="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(ps(r,t,s))return!1;for(let R=0;R<t.set.length;++R){const n=t.set[R];let d=null,S=null;if(n.forEach(p=>{p.semver===Es&&(p=new st(">=0.0.0")),d=d||p,S=S||p,i(p.semver,d.semver,s)?d=p:c(p.semver,S.semver,s)&&(S=p)}),d.operator===u||d.operator===o||(!S.operator||S.operator===u)&&a(r,S.semver))return!1;if(S.operator===o&&c(r,S.semver))return!1}return!0};var Ie=Rs;const Is=Ie,gs=(r,t,e)=>Is(r,t,">",e);var vs=gs;const Ls=Ie,Ss=(r,t,e)=>Ls(r,t,"<",e);var ws=Ss;const Be=D(),Ns=(r,t,e)=>(r=new Be(r,e),t=new Be(t,e),r.intersects(t,e));var Ts=Ns;const Os=ne,As=x;var Ps=(r,t,e)=>{const s=[];let i=null,a=null;const c=r.sort((n,d)=>As(n,d,e));for(const n of c)Os(n,t,e)?(a=n,i||(i=n)):(a&&s.push([i,a]),a=null,i=null);i&&s.push([i,null]);const u=[];for(const[n,d]of s)n===d?u.push(n):!d&&n===c[0]?u.push("*"):d?n===c[0]?u.push(`<=${d}`):u.push(`${n} - ${d}`):u.push(`>=${n}`);const o=u.join(" || "),R=typeof t.raw=="string"?t.raw:String(t);return o.length<R.length?o:t};const je=D(),ge=se(),{ANY:le}=ge,q=ne,ve=x,ys=(r,t,e={})=>{if(r===t)return!0;r=new je(r,e),t=new je(t,e);let s=!1;e:for(const i of r.set){for(const a of t.set){const c=xs(i,a,e);if(s=s||c!==null,c)continue e}if(s)return!1}return!0},Cs=[new ge(">=0.0.0-0")],ke=[new ge(">=0.0.0")],xs=(r,t,e)=>{if(r===t)return!0;if(r.length===1&&r[0].semver===le){if(t.length===1&&t[0].semver===le)return!0;e.includePrerelease?r=Cs:r=ke}if(t.length===1&&t[0].semver===le){if(e.includePrerelease)return!0;t=ke}const s=new Set;let i,a;for(const p of r)p.operator===">"||p.operator===">="?i=Xe(i,p,e):p.operator==="<"||p.operator==="<="?a=Ve(a,p,e):s.add(p.semver);if(s.size>1)return null;let c;if(i&&a){if(c=ve(i.semver,a.semver,e),c>0)return null;if(c===0&&(i.operator!==">="||a.operator!=="<="))return null}for(const p of s){if(i&&!q(p,String(i),e)||a&&!q(p,String(a),e))return null;for(const V of t)if(!q(p,String(V),e))return!1;return!0}let u,o,R,n,d=a&&!e.includePrerelease&&a.semver.prerelease.length?a.semver:!1,S=i&&!e.includePrerelease&&i.semver.prerelease.length?i.semver:!1;d&&d.prerelease.length===1&&a.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(const p of t){if(n=n||p.operator===">"||p.operator===">=",R=R||p.operator==="<"||p.operator==="<=",i){if(S&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===S.major&&p.semver.minor===S.minor&&p.semver.patch===S.patch&&(S=!1),p.operator===">"||p.operator===">="){if(u=Xe(i,p,e),u===p&&u!==i)return!1}else if(i.operator===">="&&!q(i.semver,String(p),e))return!1}if(a){if(d&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===d.major&&p.semver.minor===d.minor&&p.semver.patch===d.patch&&(d=!1),p.operator==="<"||p.operator==="<="){if(o=Ve(a,p,e),o===p&&o!==a)return!1}else if(a.operator==="<="&&!q(a.semver,String(p),e))return!1}if(!p.operator&&(a||i)&&c!==0)return!1}return!(i&&R&&!a&&c!==0||a&&n&&!i&&c!==0||S||d)},Xe=(r,t,e)=>{if(!r)return t;const s=ve(r.semver,t.semver,e);return s>0?r:s<0||t.operator===">"&&r.operator===">="?t:r},Ve=(r,t,e)=>{if(!r)return t;const s=ve(r.semver,t.semver,e);return s<0?r:s>0||t.operator==="<"&&r.operator==="<="?t:r};var Ds=ys;const ue=z,Me=ee,_s=P,qe=Qe,Us=X,bs=Xt,Gs=qt,Fs=Ht,Bs=Wt,js=Jt,ks=tr,Xs=nr,Vs=ar,Ms=x,qs=fr,zs=dr,Hs=pe,Ys=Rr,Ws=vr,Ks=re,Zs=me,Js=et,Qs=tt,en=$e,tn=Re,rn=rt,sn=Mr,nn=se(),on=D(),an=ne,cn=Zr,ln=ts,un=is,fn=cs,hn=fs,En=Ie,dn=vs,pn=ws,mn=Ts,$n=Ps,Rn=Ds;var In={parse:Us,valid:bs,clean:Gs,inc:Fs,diff:Bs,major:js,minor:ks,patch:Xs,prerelease:Vs,compare:Ms,rcompare:qs,compareLoose:zs,compareBuild:Hs,sort:Ys,rsort:Ws,gt:Ks,lt:Zs,eq:Js,neq:Qs,gte:en,lte:tn,cmp:rn,coerce:sn,Comparator:nn,Range:on,satisfies:an,toComparators:cn,maxSatisfying:ln,minSatisfying:un,minVersion:fn,validRange:hn,outside:En,gtr:dn,ltr:pn,intersects:mn,simplifyRange:$n,subset:Rn,SemVer:_s,re:ue.re,src:ue.src,tokens:ue.t,SEMVER_SPEC_VERSION:Me.SEMVER_SPEC_VERSION,RELEASE_TYPES:Me.RELEASE_TYPES,compareIdentifiers:qe.compareIdentifiers,rcompareIdentifiers:qe.rcompareIdentifiers};const ze=gt(In);var O;(function(r){r.blue="blue",r.nanoS="nanoS",r.nanoSP="nanoSP",r.nanoX="nanoX",r.stax="stax",r.europa="europa"})(O||(O={}));const he={[O.blue]:{id:O.blue,productName:"Ledger Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:480*1024,masks:[822083584,822149120],getBlockSize:r=>4*1024},[O.nanoS]:{id:O.nanoS,productName:"Ledger Nano S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:320*1024,masks:[823132160],getBlockSize:r=>ze.lt(ze.coerce(r)??"","2.0.0")?4*1024:2*1024},[O.nanoX]:{id:O.nanoX,productName:"Ledger Nano X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2*1024*1024,masks:[855638016],getBlockSize:r=>4*1024,bluetoothSpec:[{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-0004-0003-4c6564676572"}]},[O.nanoSP]:{id:O.nanoSP,productName:"Ledger Nano S Plus",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1533*1024,masks:[856686592],getBlockSize:r=>32},[O.stax]:{id:O.stax,productName:"Ledger Stax",productIdMM:96,legacyUsbProductId:6,usbOnly:!1,memorySize:1533*1024,masks:[857735168],getBlockSize:r=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-6004-0000-4c6564676572",notifyUuid:"13d63400-2c97-6004-0001-4c6564676572",writeUuid:"13d63400-2c97-6004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-6004-0003-4c6564676572"}]},[O.europa]:{id:O.europa,productName:"Ledger Flex",productIdMM:112,legacyUsbProductId:7,usbOnly:!1,memorySize:1533*1024,masks:[858783744],getBlockSize:r=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-3004-0000-4c6564676572",notifyUuid:"13d63400-2c97-3004-0001-4c6564676572",writeUuid:"13d63400-2c97-3004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-3004-0003-4c6564676572"}]}};O.blue,O.nanoS,O.nanoSP,O.nanoX,O.stax,O.europa;const He=Object.values(he),nt=11415,Ye=r=>{const t=He.find(i=>i.legacyUsbProductId===r);if(t)return t;const e=r>>8;return He.find(i=>i.productIdMM===e)},gn=[],We={};for(const r in he){const t=he[r],{bluetoothSpec:e}=t;if(e)for(let s=0;s<e.length;s++){const i=e[s];gn.push(i.serviceUuid),We[i.serviceUuid]=We[i.serviceUuid.replace(/-/g,"")]={deviceModel:t,...i}}}const vn=[{vendorId:nt}],Ln=()=>Promise.resolve(!!(window.navigator&&window.navigator.hid)),Q=()=>{const{hid:r}=navigator;if(!r)throw new U("navigator.hid is not supported","HIDNotSupported");return r};async function it(){const r=await Q().requestDevice({filters:vn});return Array.isArray(r)?r:[r]}async function Ee(){return(await Q().getDevices()).filter(t=>t.vendorId===nt)}async function Sn(){const r=await Ee();return r.length>0?r[0]:(await it())[0]}const F=class F extends j{constructor(e){super();L(this,"device");L(this,"deviceModel");L(this,"channel",Math.floor(Math.random()*65535));L(this,"packetSize",64);L(this,"inputs",[]);L(this,"inputCallback");L(this,"read",()=>this.inputs.length?Promise.resolve(this.inputs.shift()):new Promise(e=>{this.inputCallback=e}));L(this,"onInputReport",e=>{const s=Buffer.from(e.data.buffer);this.inputCallback?(this.inputCallback(s),this.inputCallback=null):this.inputs.push(s)});L(this,"_disconnectEmitted",!1);L(this,"_emitDisconnect",e=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",e))});L(this,"exchange",async e=>await this.exchangeAtomicImpl(async()=>{const{channel:i,packetSize:a}=this;Ne("apdu","=> "+e.toString("hex"));const c=Tt(i,a),u=c.makeBlocks(e);for(let n=0;n<u.length;n++)await this.device.sendReport(0,u[n]);let o,R;for(;!(o=c.getReducedResult(R));)try{const n=await this.read();R=c.reduceResponse(R,n)}catch(n){if(n instanceof U&&n.id==="InvalidChannel")continue;throw n}return Ne("apdu","<= "+o.toString("hex")),o}).catch(i=>{throw i&&i.message&&i.message.includes("write")?(this._emitDisconnect(i),new vt(i.message)):i}));this.device=e,this.deviceModel=typeof e.productId=="number"?Ye(e.productId):void 0,e.addEventListener("inputreport",this.onInputReport)}static async request(){const[e]=await it();return F.open(e)}static async openConnected(){const e=await Ee();return e.length===0?null:F.open(e[0])}static async open(e){await e.open();const s=new F(e),i=a=>{e===a.device&&(Q().removeEventListener("disconnect",i),s._emitDisconnect(new Lt))};return Q().addEventListener("disconnect",i),s}async close(){await this.exchangeBusyPromise,this.device.removeEventListener("inputreport",this.onInputReport),await this.device.close()}setScrambleKey(){}};L(F,"isSupported",Ln),L(F,"list",Ee),L(F,"listen",e=>{let s=!1;Sn().then(a=>{if(!a)e.error(new we("Access denied to use Ledger device"));else if(!s){const c=typeof a.productId=="number"?Ye(a.productId):void 0;e.next({type:"add",descriptor:a,deviceModel:c}),e.complete()}},a=>{e.error(new we(a.message))});function i(){s=!0}return{unsubscribe:i}});let Ke=F;export{Ke as default};
